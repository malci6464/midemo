<!DOCTYPE html><html lang="en" class="antialiased break-words"> <head><!-- High Priority Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Fighting the regression | malcolmisaacs.com</title><meta name="generator" content="Astro v5.15.5"><!-- Fonts --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400..700&family=Newsreader:ital,opsz,wght@0,6..72,400..700;1,6..72,400..700&display=swap" rel="stylesheet"><!-- KaTeX for math rendering --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous"><!-- Low Priority Global Metadata --><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="RSS"><!-- Page Metadata --><link rel="canonical" href="https://example.com/blog/post-9/"><meta name="description" content="This is a journey through the trials, tactics, and surprises of building a reliable time series model despite relentless regression to the mean."><!-- Open Graph / Facebook --><meta property="og:type" content="article"><meta property="og:url" content="https://example.com/blog/post-9/"><meta property="og:title" content="Fighting the regression | malcolmisaacs.com"><meta property="og:description" content="This is a journey through the trials, tactics, and surprises of building a reliable time series model despite relentless regression to the mean."><meta property="og:image" content="https://example.com/steve.jpg"><meta property="og:image:alt" content="steve jobs"><!-- X/Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://example.com/blog/post-9/"><meta property="twitter:title" content="Fighting the regression | malcolmisaacs.com"><meta property="twitter:description" content="This is a journey through the trials, tactics, and surprises of building a reliable time series model despite relentless regression to the mean."><meta property="twitter:image" content="https://example.com/steve.jpg"><meta name="twitter:image:alt" content="steve jobs"><script type="module">localStorage.theme==="dark"&&document.documentElement.classList.add("dark");</script><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.elfUsALL.js"></script><link rel="stylesheet" href="/_astro/_slug_.8I4Xzdjd.css"></head> <body class="bg-main text-main"> <div class="flex flex-col min-h-screen px-4 md:px-8"> <nav class="min-h-10 pt-4 pb-12 relative sm:min-h-14 sm:pb-24 md:pt-8" data-astro-cid-dmqpwcec> <div class="w-full max-w-3xl mx-auto relative" data-astro-cid-dmqpwcec> <button class="menu-toggle w-8 h-8 -ml-1 flex items-center justify-center relative z-30 md:hidden" aria-label="Open Menu" aria-expanded="false" aria-controls="menu-items" data-astro-cid-dmqpwcec> <span class="menu-toggle-icon w-6 h-px relative bg-current" data-astro-cid-dmqpwcec></span> </button> <ul id="menu-items" class="menu flex gap-6" data-astro-cid-dmqpwcec> <li class="py-1" data-astro-cid-dmqpwcec> <a class="text-xl font-serif text-main hover:underline hover:underline-offset-2 hover:decoration-1 md:text-base" href="/" data-astro-cid-dmqpwcec="true"> Home </a> </li><li class="py-1" data-astro-cid-dmqpwcec> <a class="text-xl font-serif text-main hover:underline hover:underline-offset-2 hover:decoration-1 md:text-base" href="/blog" data-astro-cid-dmqpwcec="true"> Blog </a> </li><li class="py-1" data-astro-cid-dmqpwcec> <a class="text-xl font-serif text-main hover:underline hover:underline-offset-2 hover:decoration-1 md:text-base" href="/tags" data-astro-cid-dmqpwcec="true"> Tags </a> </li> </ul> </div> <div class="absolute right-0 top-4 z-10 md:top-8" data-astro-cid-dmqpwcec> <button id="theme-toggle" class="w-8 h-8 -mr-2 flex items-center justify-center" aria-label="Change color scheme"> <svg class="w-4 h-4 fill-current" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"> <circle cx="8" cy="8" r="8"></circle> </svg> </button> <script type="module">document.addEventListener("astro:after-swap",()=>{localStorage.theme==="dark"&&document.documentElement.classList.add("dark")});</script> <script type="module">document.addEventListener("astro:page-load",()=>{const e=typeof localStorage<"u"&&localStorage.getItem("theme")?localStorage.getItem("theme")||"light":window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";e==="light"?document.documentElement.classList.remove("dark"):document.documentElement.classList.add("dark"),window.localStorage.setItem("theme",e);const o=()=>{const t=document.documentElement;t.classList.toggle("dark");const a=t.classList.contains("dark");localStorage.setItem("theme",a?"dark":"light")};document.getElementById("theme-toggle")?.addEventListener("click",o)});</script> </div> </nav>  <script type="module">function n(){const s=document.querySelector(".menu"),e=document.querySelector(".menu-toggle");e?.addEventListener("click",()=>{const t=e.getAttribute("aria-expanded")==="true";e.classList.toggle("is-active"),e.setAttribute("aria-expanded",t?"false":"true"),e.setAttribute("aria-label",t?"Open Menu":"Close Menu"),s?.classList.toggle("is-visible")})}n();document.addEventListener("astro:after-swap",n);</script>  <main class="grow w-full max-w-3xl mx-auto">  <article class="mb-16 sm:mb-24"> <header class="mb-8"> <h1 class="text-3xl leading-tight font-serif font-medium sm:text-5xl sm:leading-tight">Fighting the regression</h1> <div class="mt-4 text-sm"> <time datetime="2024-11-12T23:00:00.000Z"> November 13, 2024 </time>  </div> </header> <div class="max-w-none prose prose-dante sm:prose-md"> <p><img src="/post-9.png" alt="Signal in the data"></p>
<p>THE CHALLENGE: REGRESSION TO THE MEAN</p>
<p>Over the last few weeks, I carved out time to work on a small time series model, aiming to predict data usage. The journey began with a core challenge: the data was highly skewed and concentrated, seemingly random within a tight normal range. Extreme density around the mean value turned model building into a battle to justify its value, as even basic statistics – like averaging over months – seemed almost as effective. In short, regression to the mean was our enemy, as the data seemed devoid of useful variability.</p>
<p>PRE-PROCESSING FOR SIGNAL</p>
<p>As with any ML problem, pre-processing was vital, and here I learned a few key lessons. Due to the data’s commercial sensitivity, I can’t reveal specifics, but the extreme density around the mean value meant that simply sampling data to dilute the concentration didn’t help. It remained challenging for the model to capture any pattern.</p>
<p>Given a 24-month time span, I experimented with windowing techniques, such as rolling averages and peak-value extractions. A major decision lay in defining the target value. Initially, I tried using a derived combination of two columns to create a single normalized number for deployment. Unfortunately, this didn’t capture the effect we were hoping for as well as using an absolute column value. Eventually, I settled on using an LSTM and applying rolling averages and peak values within specific windows, which enabled some capture of temporal patterns.</p>
<p>The takeaway here? Don’t settle too early on a target, assuming domain-normalized values are the only option. Sometimes, a straightforward approach can yield more insight.</p>
<p>WHICH MODEL TO USE?</p>
<p>I’m writing this before any production deployment, while the pain of trial and error is still fresh. The model itself may still evolve from the current LSTM. Initially, I tried an XGBoost hybrid for its robustness with sparse data, but it, too, fell prey to the narrow range of predictions. An ensemble architecture followed, designed to handle each main data area individually, but it also struggled with the tight range.</p>
<p>An early attempt with a transformer model didn’t yield much, although since then, I’ve refined the training data, so a revisit may be worth it. For now, the LSTM’s ability to highlight temporal patterns, combined with engineered features, has managed to surface some signals in the data.</p>
<p>CUSTOM LOSS FUNCTIONS</p>
<p>For a couple of days, I focused on custom loss functions, aiming to pull predictions away from the mean. The goal was to exaggerate variance, capturing spikes or dips that generic loss functions were ignoring. Below is an early iteration of this work, where predictions are “stretched” from the mean. I also experimented with a quantile loss function, though the result remained underwhelming.</p>
<p>class WeightedMSELoss(nn.Module):</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>def __init__(self, base_weight=1.0, prob_weight=2.0, stretch_factor=1.2):</span></span>
<span class="line"><span>    super(WeightedMSELoss, self).__init__()</span></span>
<span class="line"><span>    self.base_weight = base_weight</span></span>
<span class="line"><span>    self.prob_weight = prob_weight</span></span>
<span class="line"><span>    self.stretch_factor = stretch_factor</span></span>
<span class="line"><span></span></span>
<span class="line"><span>def forward(self, predictions, targets, temporal_weights):</span></span>
<span class="line"><span>    mean_pred = torch.mean(predictions)</span></span>
<span class="line"><span>    mean_target = torch.mean(targets)</span></span>
<span class="line"><span>    stretched_preds = mean_pred + (predictions - mean_pred) * self.stretch_factor</span></span>
<span class="line"><span>    weights = self.base_weight + (temporal_weights * self.prob_weight)</span></span>
<span class="line"><span>    deviation_weight = 1.0 + torch.abs(targets - mean_target) / mean_target</span></span>
<span class="line"><span>    weights = weights * deviation_weight</span></span>
<span class="line"><span>    return torch.mean(weights * (stretched_preds - targets) ** 2)</span></span></code></pre>
<p>OPTIMIZING TRAINING EPOCHS</p>
<p>With the development pipeline in place, I focused on training configurations. The model generalized well early on, but I assumed lower loss scores meant more training was beneficial. Here’s where I went wrong. Post-analysis showed I was overtraining; five epochs sufficed! This underscored the importance of ongoing evaluation instead of assuming that lower loss always equals better predictions.</p>
<p>RESULTS AND INSIGHTS</p>
<p>A final adjustment involved grouping predictions, which helped reduce noise in practical applications and better aligned with the use case. Visualizing grouped predictions against actual results, with standard deviation bands in the background, provided valuable insights into the model’s reactions. However, without a set of ‘evals’ for accepted prediction ranges, further fine-tuning will likely be needed. Running more experiments programmatically will help expose model weaknesses.</p> </div> <div class="mt-8 flex flex-wrap items-center gap-6 text-sm justify-between sm:mt-12 sm:text-base"> <div class="flex flex-wrap gap-x-5 gap-y-1 text-sm"> <a class="text-main hover:underline" href="/tags/lstm">
#LSTM </a> </div> <button class="inline-flex items-center justify-center px-6 py-2 font-serif text-sm leading-tight italic  text-main bg-main border border-main rounded-full transition hover:bg-muted copy-url-button" aria-label="Copy link" data-url="https://example.com/blog/post-9/" data-tooltip-default="Copy link" data-tooltip-success="Copied">Share</button> </div> </article> <div class="my-16 sm:my-24"> <h2 class="mb-12 text-xl font-serif italic sm:mb-16 sm:text-2xl">Read Next</h2> <a class="flex justify-between items-start gap-8 group mb-10 sm:mb-12" href="/blog/post-10/"> <div class="grow"> <h3 class="text-xl leading-tight font-serif font-medium group-hover:underline group-hover:decoration-dashed group-hover:underline-offset-4 group-hover:decoration-1 sm:text-2xl">Perceptron math - part 1</h3> <div class="mt-1 text-sm leading-normal"> <time datetime="2025-11-12T23:00:00.000Z"> November 13, 2025 </time>  </div> <div class="mt-3 text-sm leading-normal">Going down to a base level of the perceptron to ensure foundational understanding and intuition in general ML dev.</div> </div> <div class="hidden font-serif italic opacity-0 transition group-hover:opacity-100 sm:inline-flex sm:gap-1 sm:items-center sm:shrink-0">
Read Post <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current w-4 h-4"> <path d="M4.286 12c0-0.533 0.432-0.964 0.964-0.964v0h11.172l-4.14-4.138c-0.175-0.175-0.283-0.416-0.283-0.683 0-0.533 0.432-0.965 0.965-0.965 0.267 0 0.508 0.108 0.683 0.283v0l5.785 5.785c0.175 0.175 0.283 0.416 0.283 0.683s-0.108 0.508-0.283 0.683l-5.785 5.785c-0.175 0.175-0.416 0.283-0.683 0.283-0.533 0-0.965-0.432-0.965-0.965 0-0.267 0.108-0.508 0.283-0.683v0l4.14-4.138h-11.172c-0.533 0-0.964-0.432-0.964-0.964v0z"></path> </svg> </div> </a> <a class="flex justify-between items-start gap-8 group mb-10 sm:mb-12" href="/blog/post-8/"> <div class="grow"> <h3 class="text-xl leading-tight font-serif font-medium group-hover:underline group-hover:decoration-dashed group-hover:underline-offset-4 group-hover:decoration-1 sm:text-2xl">Tokenization</h3> <div class="mt-1 text-sm leading-normal"> <time datetime="2024-08-28T22:00:00.000Z"> August 29, 2024 </time>  </div> <div class="mt-3 text-sm leading-normal">“Tokenization is at the heart of much weirdness of LLMs. Do not brush it off.” AK</div> </div> <div class="hidden font-serif italic opacity-0 transition group-hover:opacity-100 sm:inline-flex sm:gap-1 sm:items-center sm:shrink-0">
Read Post <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current w-4 h-4"> <path d="M4.286 12c0-0.533 0.432-0.964 0.964-0.964v0h11.172l-4.14-4.138c-0.175-0.175-0.283-0.416-0.283-0.683 0-0.533 0.432-0.965 0.965-0.965 0.267 0 0.508 0.108 0.683 0.283v0l5.785 5.785c0.175 0.175 0.283 0.416 0.283 0.683s-0.108 0.508-0.283 0.683l-5.785 5.785c-0.175 0.175-0.416 0.283-0.683 0.283-0.533 0-0.965-0.432-0.965-0.965 0-0.267 0.108-0.508 0.283-0.683v0l4.14-4.138h-11.172c-0.533 0-0.964-0.432-0.964-0.964v0z"></path> </svg> </div> </a> </div>  </main> <footer class="w-full max-w-3xl mx-auto pt-12 pb-10 sm:pt-24 sm:pb-14">  <div class="pt-6 flex flex-col gap-4 border-t border-dashed border-main">  <p class="text-sm">
&copy; 2025&nbsp;<a class="hover:underline hover:underline-offset-2" href="/">malcolmisaacs.com</a>. All rights reserved.
</p> </div> </footer> </div> </body></html> <script type="module">document.addEventListener("astro:page-load",()=>{const t=document.querySelector(".copy-url-button");t?.addEventListener("click",async()=>{await a(t)});async function a(e){let n=e.getAttribute("data-url")||"",r=e.innerText;await navigator.clipboard.writeText(n),e.innerText="Copied",setTimeout(()=>{e.innerText=r},2500)}});</script>